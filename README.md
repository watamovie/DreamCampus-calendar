# DreamCampus to Calendar

このアプリは [https://dreamcampus-calendar.pages.dev](https://dreamcampus-calendar.pages.dev) でホストされています。

iOS ショートカット経由で受け取った **イベント JSON** から
ブラウザだけで一括 **.ics** ファイルを生成する React + Vite 製アプリです。
受け渡しに失敗したり内容を調整したい場合は、Web UI 上で貼り付け・編集してから出力できます。

## 特徴
| 機能 | 説明 |
|------|------|
| クリップボード読込 | `navigator.clipboard.readText()` 対応。テキストボックスへの貼り付けも可 |
| URL 渡し | `?data=` クエリに UTF-8 Base64 文字列を入れると自動読込 |
| 欠落補完 UI | 日付と時刻、科目名が必須。その他が空欄なら黄色で警告しつつ ICS 生成可 |
| 自動分類 | `DESCRIPTION` 内のキーワードから **対面 / zoom / オンデマ** を推定し、DESCRIPTION を編集すると自動で再判定 |
| LOCATION 抽出 | `/ ○○室 /` パターンを正規表現で抜き出し、DESCRIPTION 変更時にも反映 |
| DESCRIPTION 保持 | 改行をそのままエスケープして ICS の `DESCRIPTION` に反映 |
| 完全 Frontend | **ics-js** を用いてクライアント側で .ics テキストを生成 → Blob → ダウンロード |
| 場所未入力許可 | 対面でも場所が空の場合は黄色で警告。空欄のままでも ICS 作成可能 |
| 編集内容反映 | テーブルで補った予定もそのまま ICS に反映 |
| 補完後も有効 | JSON で欠けていた項目を後から入力しても出力に反映 |
| 追加 | JSON に無い予定をテーブルから新規に追加可能 |
| リマインダー連携 | iOS ショートカット経由でリマインダーに直接登録可能。完了済みなどの項目を除外して送信 |
| ローカル保存 | 編集内容を自動保存し、次回アクセス時に復元 |

## iOS ショートカットの流れ
1. 時間割ページを共有シートから [ショートカット](https://www.icloud.com/shortcuts/7f518145f2c14b918b009dae2c71463e) を実行
2. JavaScript がページ上で走り時間割を JSON 化
3. 生成した JSON を UTF-8 で Base64 化し、URL エンコードして `?data=` 付きで本アプリを開く
   (例: `encodeURIComponent(btoa(unescape(encodeURIComponent(json))))`)
4. ページ読み込み時に `data` パラメータを自動解析。無い場合はクリップボードを読込

## 使い方
1. [iOS ショートカット](https://www.icloud.com/shortcuts/7f518145f2c14b918b009dae2c71463e) を実行すると本アプリが自動で開き、予定が入力されます
2. そのまま **カレンダーに追加** を押せますが、受け渡しに失敗したり内容を調整したい場合は Web UI で貼り付け・編集してください
3. 予定を確認したら **カレンダーに追加** ボタンで .ics を取得できます。編集内容は自動保存されます

## iOS リマインダー連携の使い方
1. 画面右上またはテキストエリア下部の **リマインダーに追加** ボタンを押すとポップアップが開きます
2. ソート条件やタグ、完了済みキーワードのチェック状態を調整し、プレビューで送信対象を確認します
3. **リマインダーに送信** を押すと iOS ショートカット `DreamCampus Reminders` が起動し、プレビューに表示された予定がまとめてリマインダーへ登録されます

### 送信データ形式
ショートカットへは Base64 でエンコードした JSON 文字列を `shortcuts://x-callback-url/run-shortcut` の `text` パラメータに渡しています。デコードすると次のような構造になります。

```json
{
  "version": 1,
  "generatedAt": "2024-06-01T12:34:56.000Z",
  "items": [
    {
      "title": "○○講義",
      "dueDate": "2024-06-10",
      "dueTime": "09:00",
      "endTime": "10:30",
      "notes": "DESCRIPTION の内容",
      "location": "教室名など",
      "tag": "対面"
    }
  ]
}
```

### 推奨ショートカットの構成
`DreamCampus Reminders` という名前で次のアクションを組み合わせると、そのまま利用できます。

1. 入力をテキストとして取得 (`ショートカットの入力` → `テキスト`)
2. `Base64 をデコード`
3. `辞書を取得`（JSON を辞書化）
4. キー `items` の値を取得 → リストとして扱う
5. `各項目を繰り返す` でリスト内の予定を処理
6. ループ内で `リマインダーを作成` アクションを配置し、以下の項目を設定
   - タイトル: `項目` の `title`
   - 日付: `dueDate`
   - 時刻: `dueTime`
   - メモ: `notes`（場所やタグは必要に応じて付加）
   - カスタムリストや優先度が必要なら適宜設定

完了後に別アクションで通知する、URL を開くなどの処理を追加しても問題ありません。

## ショートカットキー
| キー | 動作 |
|------|------|
| `Ctrl`/`⌘` + `Shift` + `V` | クリップボード読込 |
| `Ctrl`/`⌘` + `N` | 行を追加 |
| `Ctrl`/`⌘` + `Enter` | カレンダーに追加 |
| `Ctrl`/`⌘` + `Shift` + `D` | 全データ削除 |
| `Esc` | 編集画面を閉じる |

## 開発コマンド
```bash
npm i          # 依存解決
npm run dev    # ローカルサーバ
npm run build  # 本番ビルド (dist/)
npm run preview # dist/ 内容を確認
```
